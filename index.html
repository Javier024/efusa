<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>EFUSA ‚Äì Dashboard Pro</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Chart.js para la Gr√°fica Financiera -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- Librer√≠as para Exportar -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>

  <!-- Fuente Inter -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <style>
    body { font-family: 'Inter', sans-serif; }
    
    /* Animaciones */
    .fade-in { animation: fadeIn 0.6s ease-out forwards; opacity: 0; }
    .fade-in-delay-1 { animation-delay: 0.1s; }
    .fade-in-delay-2 { animation-delay: 0.2s; }
    .fade-in-delay-3 { animation-delay: 0.3s; }
    
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    
    /* Barra de progreso personalizada */
    .progress-bar-bg { background-color: #f3f4f6; border-radius: 9999px; height: 8px; width: 100%; overflow: hidden; }
    .progress-bar-fill { height: 100%; border-radius: 9999px; transition: width 1s ease-in-out; }
  </style>
</head>

<body class="bg-gray-50 min-h-screen text-gray-800">

  <!-- Header -->
  <header class="bg-white border-b border-gray-200 sticky top-0 z-50">
    <div class="container mx-auto px-4 py-4 flex justify-between items-center">
      <div class="flex items-center gap-3">
        <div class="bg-green-600 text-white p-2 rounded-xl shadow-lg shadow-green-200">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
          </svg>
        </div>
        <div>
          <h1 class="text-xl font-bold tracking-tight text-gray-900">EFUSA</h1>
          <p class="text-xs text-gray-500 font-medium">Panel de Control</p>
        </div>
      </div>
      <div class="flex items-center gap-3">
        <div class="text-right hidden sm:block">
          <p class="text-xs text-gray-400">Usuario</p>
          <p class="text-sm font-bold text-gray-700">Administrador</p>
        </div>
        <div class="h-10 w-10 rounded-full bg-gray-200 border border-white shadow-sm overflow-hidden">
          <img src="https://ui-avatars.com/api/?name=Admin&background=0D9488&color=fff" alt="Admin" />
        </div>
      </div>
    </div>
  </header>

  <!-- Contenido Principal -->
  <main class="container mx-auto px-4 py-8">

    <!-- Secci√≥n 1: KPIs (Tarjetas) -->
    <section class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8 fade-in">
      
      <!-- KPI 1 -->
      <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100 hover:shadow-md transition-shadow">
        <div class="flex justify-between items-start">
          <div>
            <p class="text-xs font-bold text-gray-400 uppercase tracking-wider">Jugadores</p>
            <h3 class="text-3xl font-bold text-gray-900 mt-2" id="total-jugadores">0</h3>
          </div>
          <div class="p-3 bg-blue-50 text-blue-600 rounded-xl">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0z"></path></svg>
          </div>
        </div>
        <div class="mt-4 text-xs text-green-600 flex items-center font-medium">
          <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path></svg>
          Activos
        </div>
      </div>

      <!-- KPI 2 -->
      <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100 hover:shadow-md transition-shadow">
        <div class="flex justify-between items-start">
          <div>
            <p class="text-xs font-bold text-gray-400 uppercase tracking-wider">Ingresos Mes</p>
            <h3 class="text-3xl font-bold text-green-600 mt-2" id="pagos-mes">$0</h3>
          </div>
          <div class="p-3 bg-green-50 text-green-600 rounded-xl">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
          </div>
        </div>
        <div class="mt-4 text-xs text-gray-500">
          Recaudaci√≥n actual
        </div>
      </div>

      <!-- KPI 3 -->
      <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100 hover:shadow-md transition-shadow">
        <div class="flex justify-between items-start">
          <div>
            <p class="text-xs font-bold text-gray-400 uppercase tracking-wider">Morosos</p>
            <h3 class="text-3xl font-bold text-red-600 mt-2" id="morosos">0</h3>
          </div>
          <div class="p-3 bg-red-50 text-red-600 rounded-xl">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg>
          </div>
        </div>
        <div class="mt-4 text-xs text-gray-500">
          Pendientes este mes
        </div>
      </div>

      <!-- KPI 4 -->
      <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100 hover:shadow-md transition-shadow">
        <div class="flex justify-between items-start">
          <div>
            <p class="text-xs font-bold text-gray-400 uppercase tracking-wider">Categor√≠as</p>
            <h3 class="text-3xl font-bold text-purple-600 mt-2">4</h3>
          </div>
          <div class="p-3 bg-purple-50 text-purple-600 rounded-xl">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path></svg>
          </div>
        </div>
        <div class="mt-4 text-xs text-gray-500">
          Activas en sistema
        </div>
      </div>

    </section>

    <!-- Secci√≥n 2: Gr√°fica y Goleadores -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8">
      
      <!-- Gr√°fica Financiera (Ocupa 2 columnas) -->
      <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 lg:col-span-2 fade-in fade-in-delay-1">
        <div class="flex justify-between items-center mb-6">
          <h3 class="font-bold text-gray-800">Historial de Ingresos</h3>
          <select class="text-xs border-gray-200 border rounded-lg px-2 py-1 text-gray-500 bg-gray-50 outline-none">
            <option>√öltimos 6 meses</option>
          </select>
        </div>
        <div class="relative h-64 w-full">
          <canvas id="ingresosChart"></canvas>
        </div>
      </div>

      <!-- Top Goleadores (Ocupa 1 columna) -->
      <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 fade-in fade-in-delay-2">
        <div class="flex items-center gap-2 mb-6">
          <div class="p-2 bg-yellow-100 text-yellow-600 rounded-lg">
            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/></svg>
          </div>
          <h3 class="font-bold text-gray-800">Top Goleadores</h3>
        </div>
        
        <div id="goleadores-list" class="space-y-4">
          <!-- Se llena con JS -->
          <div class="text-center text-gray-400 py-4 text-sm">Cargando estad√≠sticas...</div>
        </div>
      </div>

    </div>

    <!-- Secci√≥n 3: Tablas Detalladas -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">

      <!-- TABLA 1: PR√ìXIMOS VENCIMIENTOS -->
      <section class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden fade-in fade-in-delay-3">
        <div class="p-5 border-b border-gray-100 flex justify-between items-center bg-gray-50">
          <h3 class="font-bold text-gray-700 flex items-center gap-2">
            <span class="text-lg">üìÖ</span> Pr√≥ximos Vencimientos
          </h3>
          <div class="flex gap-2">
            <button onclick="exportTableToExcel('tabla-vencimientos', 'vencimientos_efusa')" class="text-xs bg-white border border-gray-200 text-gray-600 px-3 py-1.5 rounded-lg hover:bg-green-50 hover:text-green-600 hover:border-green-200 transition font-medium shadow-sm">Excel</button>
            <button onclick="exportTableToPDF('tabla-vencimientos', 'vencimientos_efusa')" class="text-xs bg-white border border-gray-200 text-gray-600 px-3 py-1.5 rounded-lg hover:bg-red-50 hover:text-red-600 hover:border-red-200 transition font-medium shadow-sm">PDF</button>
          </div>
        </div>
        
        <div class="overflow-x-auto">
          <table class="w-full text-sm text-left" id="tabla-vencimientos">
            <thead class="bg-gray-50 text-gray-500 uppercase text-xs font-semibold">
              <tr>
                <th class="px-6 py-3">Jugador</th>
                <th class="px-6 py-3">Categor√≠a</th>
                <th class="px-6 py-3">Vence</th>
                <th class="px-6 py-3 text-center">Estado</th>
              </tr>
            </thead>
            <tbody id="body-vencimientos" class="divide-y divide-gray-100">
              <!-- JS -->
            </tbody>
          </table>
        </div>
      </section>

      <!-- TABLA 2: √öLTIMOS MOVIMIENTOS -->
      <section class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden fade-in fade-in-delay-3">
        <div class="p-5 border-b border-gray-100 flex justify-between items-center bg-gray-50">
          <h3 class="font-bold text-gray-700 flex items-center gap-2">
            <span class="text-lg">üïí</span> √öltimos Pagos
          </h3>
          <div class="flex gap-2">
            <button onclick="exportTableToExcel('tabla-movimientos', 'movimientos_efusa')" class="text-xs bg-white border border-gray-200 text-gray-600 px-3 py-1.5 rounded-lg hover:bg-green-50 hover:text-green-600 hover:border-green-200 transition font-medium shadow-sm">Excel</button>
            <button onclick="exportTableToPDF('tabla-movimientos', 'movimientos_efusa')" class="text-xs bg-white border border-gray-200 text-gray-600 px-3 py-1.5 rounded-lg hover:bg-red-50 hover:text-red-600 hover:border-red-200 transition font-medium shadow-sm">PDF</button>
          </div>
        </div>

        <div class="overflow-x-auto">
          <table class="w-full text-sm text-left" id="tabla-movimientos">
            <thead class="bg-gray-50 text-gray-500 uppercase text-xs font-semibold">
              <tr>
                <th class="px-6 py-3">Fecha</th>
                <th class="px-6 py-3">Jugador</th>
                <th class="px-6 py-3">Monto</th>
                <th class="px-6 py-3">Tipo</th>
              </tr>
            </thead>
            <tbody id="body-movimientos" class="divide-y divide-gray-100">
              <!-- JS -->
            </tbody>
          </table>
        </div>
      </section>

    </div>

    <!-- Secci√≥n 4: Accesos R√°pidos -->
    <section class="grid grid-cols-1 md:grid-cols-3 gap-6 fade-in fade-in-delay-3">
      
      <a href="jugadores.html" class="group bg-gradient-to-br from-blue-50 to-white p-6 rounded-2xl shadow-sm hover:shadow-xl transition border border-blue-100 flex items-center gap-4">
        <div class="p-3 bg-white text-blue-600 rounded-xl shadow-sm group-hover:scale-110 transition-transform duration-300">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>
        </div>
        <div>
          <h3 class="font-bold text-gray-800">Gesti√≥n Jugadores</h3>
          <p class="text-xs text-gray-500 mt-1">Fichas y Estad√≠sticas</p>
        </div>
      </a>

      <a href="pagos.html" class="group bg-gradient-to-br from-green-50 to-white p-6 rounded-2xl shadow-sm hover:shadow-xl transition border border-green-100 flex items-center gap-4">
        <div class="p-3 bg-white text-green-600 rounded-xl shadow-sm group-hover:scale-110 transition-transform duration-300">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"></path></svg>
        </div>
        <div>
          <h3 class="font-bold text-gray-800">Caja y Pagos</h3>
          <p class="text-xs text-gray-500 mt-1">Registrar ingresos</p>
        </div>
      </a>

      <a href="alertas.html" class="group bg-gradient-to-br from-red-50 to-white p-6 rounded-2xl shadow-sm hover:shadow-xl transition border border-red-100 flex items-center gap-4">
        <div class="p-3 bg-white text-red-600 rounded-xl shadow-sm group-hover:scale-110 transition-transform duration-300">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path></svg>
        </div>
        <div>
          <h3 class="font-bold text-gray-800">Alertas y Deudas</h3>
          <p class="text-xs text-gray-500 mt-1">Cartera vencida</p>
        </div>
      </a>

    </section>

  </main>

  <!-- LOGICA JAVASCRIPT -->
  <script>
    // --- 1. CONFIGURACI√ìN ---
    const formatMoney = (amount) => {
      return new Intl.NumberFormat('es-CO', { style: 'currency', currency: 'COP', minimumFractionDigits: 0 }).format(amount);
    };

    const formatDate = (dateString) => {
      if (!dateString) return '-';
      const options = { year: 'numeric', month: 'short', day: 'numeric' };
      return new Date(dateString).toLocaleDateString('es-ES', options);
    };

    // --- 2. EXPORTACI√ìN ---
    window.exportTableToExcel = function(tableId, filename = ''){
      const table = document.getElementById(tableId);
      const wb = XLSX.utils.table_to_book(table, {sheet: "Hoja 1"});
      XLSX.writeFile(wb, filename + '.xlsx');
    }

    window.exportTableToPDF = function(tableId, filename = ''){
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      doc.text("Reporte EFUSA", 14, 15);
      doc.autoTable({ html: '#' + tableId, startY: 20, theme: 'grid', headStyles: { fillColor: [22, 163, 74] } });
      doc.save(filename + '.pdf');
    }

    // --- 3. GR√ÅFICA DE INGRESOS (Chart.js) ---
    let chartInstance = null;

    function renderChart(pagos) {
      const ctx = document.getElementById('ingresosChart').getContext('2d');
      
      // Preparar datos √∫ltimos 6 meses
      const meses = [];
      const montos = [];
      for (let i = 5; i >= 0; i--) {
        const d = new Date();
        d.setMonth(d.getMonth() - i);
        const mesNombre = d.toLocaleString('es-ES', { month: 'short' });
        meses.push(mesNombre.charAt(0).toUpperCase() + mesNombre.slice(1));
        
        // Sumar pagos de este mes
        const totalMes = pagos
          .filter(p => {
            const fp = new Date(p.fecha_pago);
            return fp.getMonth() === d.getMonth() && fp.getFullYear() === d.getFullYear();
          })
          .reduce((acc, curr) => acc + parseFloat(curr.monto), 0);
        montos.push(totalMes);
      }

      if (chartInstance) chartInstance.destroy();

      chartInstance = new Chart(ctx, {
        type: 'line',
        data: {
          labels: meses,
          datasets: [{
            label: 'Ingresos ($)',
            data: montos,
            borderColor: '#16a34a', // Green-600
            backgroundColor: 'rgba(22, 163, 74, 0.1)',
            borderWidth: 2,
            fill: true,
            tension: 0.4,
            pointRadius: 4,
            pointBackgroundColor: '#16a34a'
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: { display: false }
          },
          scales: {
            y: {
              beginAtZero: true,
              grid: { color: '#f3f4f6' }
            },
            x: {
              grid: { display: false }
            }
          }
        }
      });
    }

    // --- 4. L√ìGICA DE NEGOCIO ---

    async function initDashboard() {
      try {
        const [resPagos, resJugadores] = await Promise.all([
          fetch('/api/pagos'),
          fetch('/api/jugadores') 
        ]);

        if (!resPagos.ok || !resJugadores.ok) throw new Error("Error conectando API");

        const pagos = await resPagos.json();
        const jugadores = await resJugadores.json();

        renderKPIs(jugadores, pagos);
        renderChart(pagos);
        renderGoleadores(jugadores);
        renderVencimientos(jugadores, pagos);
        renderMovimientos(pagos, jugadores);

      } catch (error) {
        console.error(error);
        alert("Hubo un error cargando los datos.");
      }
    }

    function renderKPIs(jugadores, pagos) {
      // Animaci√≥n simple de conteo
      animateValue("total-jugadores", 0, jugadores.length, 1000);
      
      // Ingresos Mes
      const hoy = new Date();
      const ingresos = pagos.reduce((sum, p) => {
        const f = new Date(p.fecha_pago);
        if (f.getMonth() === hoy.getMonth() && f.getFullYear() === hoy.getFullYear()) {
          return sum + parseFloat(p.monto);
        }
        return sum;
      }, 0);
      document.getElementById('pagos-mes').innerText = formatMoney(ingresos);

      // Morosos
      const idsPagadores = new Set(
        pagos
          .filter(p => {
            const f = new Date(p.fecha_pago);
            return f.getMonth() === hoy.getMonth() && f.getFullYear() === hoy.getFullYear();
          })
          .map(p => p.jugador_id)
      );
      const morososCount = jugadores.filter(j => !idsPagadores.has(j.id)).length;
      document.getElementById('morosos').innerText = morososCount;
    }

    function renderGoleadores(jugadores) {
      const container = document.getElementById('goleadores-list');
      container.innerHTML = '';

      // Filtrar solo los que tienen goles y ordenar
      const goleadores = jugadores
        .filter(j => j.goles > 0)
        .sort((a, b) => b.goles - a.goles)
        .slice(0, 5); // Top 5

      if (goleadores.length === 0) {
        container.innerHTML = `<div class="text-center text-gray-400 py-8 text-sm">No hay goles registrados a√∫n.</div>`;
        return;
      }

      const maxGoles = goleadores[0].goles;

      goleadores.forEach((j, index) => {
        const percent = (j.goles / maxGoles) * 100;
        
        // Color para los podios
        let iconColor = 'text-gray-400';
        if (index === 0) iconColor = 'text-yellow-500'; // Oro
        if (index === 1) iconColor = 'text-gray-400'; // Plata
        if (index === 2) iconColor = 'text-orange-700'; // Bronce

        const html = `
          <div class="flex items-center gap-3">
            <div class="flex flex-col items-center justify-center w-8">
              <span class="font-bold text-xs ${iconColor}">${index + 1}</span>
            </div>
            <div class="flex-1">
              <div class="flex justify-between items-center mb-1">
                <h4 class="text-sm font-bold text-gray-800 truncate pr-2">${j.nombre}</h4>
                <span class="text-sm font-bold text-green-600">${j.goles} <span class="text-xs text-gray-400 font-normal">goles</span></span>
              </div>
              <div class="progress-bar-bg">
                <div class="progress-bar-fill bg-green-500" style="width: ${percent}%"></div>
              </div>
            </div>
          </div>
        `;
        container.insertAdjacentHTML('beforeend', html);
      });
    }

    function renderVencimientos(jugadores, pagos) {
      const tbody = document.getElementById('body-vencimientos');
      tbody.innerHTML = '';

      const listaConVencimiento = jugadores.map(j => {
        const pagosJugador = pagos.filter(p => p.jugador_id == j.id);
        
        let ultimoPagoDate = null;
        if (pagosJugador.length > 0) {
          pagosJugador.sort((a, b) => new Date(b.fecha_pago) - new Date(a.fecha_pago));
          ultimoPagoDate = new Date(pagosJugador[0].fecha_pago);
        } else {
          ultimoPagoDate = new Date();
          ultimoPagoDate.setDate(ultimoPagoDate.getDate() - 30);
        }

        const proximoVence = new Date(ultimoPagoDate);
        proximoVence.setDate(proximoVence.getDate() + 30);

        return { ...j, proximoVence };
      });

      listaConVencimiento.sort((a, b) => a.proximoVence - b.proximoVence);
      listaConVencimiento.slice(0, 5).forEach(item => {
        const hoy = new Date();
        const diffTime = item.proximoVence - hoy;
        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)); 

        let estadoBadge = '';
        if (diffDays < 0) {
          estadoBadge = `<span class="px-2 py-1 text-xs rounded-full bg-red-50 text-red-600 font-bold">Vencido</span>`;
        } else if (diffDays <= 5) {
          estadoBadge = `<span class="px-2 py-1 text-xs rounded-full bg-yellow-50 text-yellow-700 font-bold">-${diffDays}d</span>`;
        } else {
          estadoBadge = `<span class="px-2 py-1 text-xs rounded-full bg-green-50 text-green-600">Al d√≠a</span>`;
        }

        tbody.innerHTML += `
          <tr class="hover:bg-gray-50 transition-colors">
            <td class="px-6 py-4 font-medium text-gray-900">${item.nombre}</td>
            <td class="px-6 py-4 text-gray-500 text-xs">${item.categoria || 'N/A'}</td>
            <td class="px-6 py-4 font-semibold text-gray-700">${formatDate(item.proximoVence)}</td>
            <td class="px-6 py-4 text-center">${estadoBadge}</td>
          </tr>
        `;
      });
    }

    function renderMovimientos(pagos, jugadores) {
      const tbody = document.getElementById('body-movimientos');
      tbody.innerHTML = '';

      const ultimosPagos = [...pagos]
        .sort((a, b) => new Date(b.fecha_pago) - new Date(a.fecha_pago))
        .slice(0, 5);

      ultimosPagos.forEach(pago => {
        const jugador = jugadores.find(j => j.id == pago.jugador_id);
        const nombreJugador = jugador ? jugador.nombre : 'Desconocido';

        tbody.innerHTML += `
          <tr class="hover:bg-gray-50 transition-colors">
            <td class="px-6 py-4 text-gray-500 text-xs">${formatDate(pago.fecha_pago)}</td>
            <td class="px-6 py-4 font-medium text-gray-900">${nombreJugador}</td>
            <td class="px-6 py-4 font-bold text-green-600">${formatMoney(pago.monto)}</td>
            <td class="px-6 py-4"><span class="bg-gray-100 text-gray-600 px-2 py-1 rounded text-[10px] uppercase font-bold tracking-wide">${pago.tipo || 'Abono'}</span></td>
          </tr>
        `;
      });
    }

    // Funci√≥n auxiliar para animar n√∫meros
    function animateValue(id, start, end, duration) {
      const obj = document.getElementById(id);
      let startTimestamp = null;
      const step = (timestamp) => {
        if (!startTimestamp) startTimestamp = timestamp;
        const progress = Math.min((timestamp - startTimestamp) / duration, 1);
        obj.innerHTML = Math.floor(progress * (end - start) + start);
        if (progress < 1) {
          window.requestAnimationFrame(step);
        }
      };
      window.requestAnimationFrame(step);
    }

    // Iniciar
    document.addEventListener('DOMContentLoaded', initDashboard);

  </script>
</body>
</html>