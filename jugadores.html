<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Jugadores - EFUSA</title>
</head>
<body>

<h1>Jugadores</h1>

<form id="formJugador">
  <input type="hidden" id="id">
  <input id="nombre" placeholder="Nombre" required>
  <input id="categoria" placeholder="Categor√≠a" required>
  <input id="mensualidad" type="number" placeholder="Mensualidad" required>
  <input id="acudiente" placeholder="Acudiente" required>
  <input id="telefono" placeholder="Tel√©fono" required>
  <input id="direccion" placeholder="Direcci√≥n" required>
  <input id="sangre" placeholder="Tipo sangre" required>
  <button type="submit">Guardar</button>
</form>

<table border="1" width="100%">
  <thead>
    <tr>
      <th>Nombre</th>
      <th>Categor√≠a</th>
      <th>Mensualidad</th>
      <th>Estado</th>
      <th>Acciones</th>
    </tr>
  </thead>
  <tbody id="tabla"></tbody>
</table>

<script>
let editando = false;

async function cargar() {
  const res = await fetch('/api/jugadores');
  const data = await res.json();

  tabla.innerHTML = '';

  data.forEach(j => {
    tabla.innerHTML += `
      <tr>
        <td>${j.nombre}</td>
        <td>${j.categoria}</td>
        <td>${j.mensualidad}</td>
        <td>${j.activo ? 'Activo' : 'Inactivo'}</td>
        <td>
          <button onclick='editar(${JSON.stringify(j)})'>‚úèÔ∏è</button>
          <button onclick='eliminar(${j.id})'>üóëÔ∏è</button>
        </td>
      </tr>
    `;
  });
}

function editar(j) {
  editando = true;
  id.value = j.id;
  nombre.value = j.nombre;
  categoria.value = j.categoria;
  mensualidad.value = j.mensualidad;
  acudiente.value = j.nombre_acudiente;
  telefono.value = j.telefono;
  direccion.value = j.direccion;
  sangre.value = j.tipo_sangre;
}

async function eliminar(id) {
  if (!confirm('¬øEliminar jugador?')) return;

  await fetch(`/api/jugadores?id=${id}`, { method: 'DELETE' });
  cargar();
}

formJugador.onsubmit = async e => {
  e.preventDefault();

  const data = {
    id: id.value,
    nombre: nombre.value,
    categoria: categoria.value,
    mensualidad: mensualidad.value,
    nombre_acudiente: acudiente.value,
    telefono: telefono.value,
    direccion: direccion.value,
    tipo_sangre: sangre.value,
    activo: true
  };

  await fetch('/api/jugadores', {
    method: editando ? 'PUT' : 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(data)
  });

  editando = false;
  formJugador.reset();
  cargar();
};

cargar();
</script>

</body>
</html>
